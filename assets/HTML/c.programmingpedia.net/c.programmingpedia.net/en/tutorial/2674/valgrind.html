<!DOCTYPE html>



<html lang="en" itemscope itemtype="http://schema.org/TechArticle">

<!-- Mirrored from c.programmingpedia.net/en/tutorial/2674/valgrind by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 09:03:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="Valgrind | C Language Tutorial">
        <meta name="description" property="og:description" content="Valgrind | C Language Tutorial">
        <title>Valgrind | C Language Tutorial</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
    <ul>
                    <li><a href="../../../index.html">Getting started with C Language</a></li>
                <li><a href="../6846/-ctype-h----character-classification---conversion.html">&lt;ctype.h&gt; â€” character classification &amp; conversion</a></li>
                <li><a href="../1301/aliasing-and-effective-type.html">Aliasing and effective type</a></li>
                <li><a href="../322/arrays.html">Arrays</a></li>
                <li><a href="../555/assertion.html">Assertion</a></li>
                <li><a href="../4924/atomics.html">Atomics</a></li>
                <li><a href="../1930/bit-fields.html">Bit-fields</a></li>
                <li><a href="../3336/boolean.html">Boolean</a></li>
                <li><a href="../1285/command-line-arguments.html">Command-line arguments</a></li>
                <li><a href="../10670/comments.html">Comments</a></li>
                <li><a href="../10543/common-c-programming-idioms-and-developer-practices.html">Common C programming idioms and developer practices</a></li>
                <li><a href="../2006/common-pitfalls.html">Common pitfalls</a></li>
                <li><a href="../1337/compilation.html">Compilation</a></li>
                <li><a href="../4135/compound-literals.html">Compound Literals</a></li>
                <li><a href="../7397/constraints.html">Constraints</a></li>
                <li><a href="../6257/create-and-include-header-files.html">Create and include header files</a></li>
                <li><a href="../309/data-types.html">Data Types</a></li>
                <li><a href="../3104/declaration-vs-definition.html">Declaration vs Definition</a></li>
                <li><a href="../3729/declarations.html">Declarations</a></li>
                <li><a href="../5460/enumerations.html">Enumerations</a></li>
                <li><a href="../2486/error-handling.html">Error handling</a></li>
                <li><a href="../507/files-and-i-o-streams.html">Files and I/O streams</a></li>
                <li><a href="../3750/formatted-input-output.html">Formatted Input/Output</a></li>
                <li><a href="../1006/function-parameters.html">Function Parameters</a></li>
                <li><a href="../250/function-pointers.html">Function Pointers</a></li>
                <li><a href="../571/generic-selection.html">Generic selection</a></li>
                <li><a href="../1804/identifier-scope.html">Identifier Scope</a></li>
                <li><a href="../4832/implementation-defined-behaviour.html">Implementation-defined behaviour</a></li>
                <li><a href="../2529/implicit-and-explicit-conversions.html">Implicit and Explicit Conversions</a></li>
                <li><a href="../4547/initialization.html">Initialization</a></li>
                <li><a href="../4263/inline-assembly.html">Inline assembly</a></li>
                <li><a href="../7427/inlining.html">Inlining</a></li>
                <li><a href="../10564/interprocess-communication--ipc-.html">Interprocess Communication (IPC)</a></li>
                <li><a href="../5151/iteration-statements-loops--for--while--do-while.html">Iteration Statements/Loops: for, while, do-while</a></li>
                <li><a href="../5568/jump-statements.html">Jump Statements</a></li>
                <li><a href="../560/linked-lists.html">Linked lists</a></li>
                <li><a href="../3455/literals-for-numbers--characters-and-strings.html">Literals for numbers, characters and strings</a></li>
                <li><a href="../4726/memory-management.html">Memory management</a></li>
                <li><a href="../7111/multi-character-character-sequence.html">Multi-Character Character Sequence</a></li>
                <li><a href="../10489/multithreading.html">Multithreading</a></li>
                <li><a href="../256/operators.html">Operators</a></li>
                <li><a href="../6862/pass-2d-arrays-to-functions.html">Pass 2D-arrays to functions</a></li>
                <li><a href="../1108/pointers.html">Pointers</a></li>
                <li><a href="../447/preprocessor-and-macros.html">Preprocessor and Macros</a></li>
                <li><a href="../365/random-number-generation.html">Random Number Generation</a></li>
                <li><a href="../3073/selection-statements.html">Selection Statements</a></li>
                <li><a href="../1275/sequence-points.html">Sequence points</a></li>
                <li><a href="../7094/side-effects.html">Side Effects</a></li>
                <li><a href="../453/signal-handling.html">Signal handling</a></li>
                <li><a href="../3170/standard-math.html">Standard Math</a></li>
                <li><a href="../3597/storage-classes.html">Storage Classes</a></li>
                <li><a href="../1990/strings.html">Strings</a></li>
                <li><a href="../1119/structs.html">Structs</a></li>
                <li><a href="../4590/structure-padding-and-packing.html">Structure Padding and Packing</a></li>
                <li><a href="../6779/testing-frameworks.html">Testing frameworks</a></li>
                <li><a href="../4432/threads--native-.html">Threads (native)</a></li>
                <li><a href="../2588/type-qualifiers.html">Type Qualifiers</a></li>
                <li><a href="../2681/typedef.html">Typedef</a></li>
                <li><a href="../364/undefined-behavior.html">Undefined behavior</a></li>
                <li><a href="../7645/unions.html">Unions</a></li>
                <li><a href="valgrind.html">Valgrind</a></li>
                <li><a href="../455/variable-arguments.html">Variable arguments</a></li>
                <li><a href="../628/x-macros.html">X-macros</a></li>
    </ul>

            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div class="page-article" itemprop="mainEntityOfPage">

    <h1 itemprop="headline" id="valgrind">Valgrind</h1>
    
    <div itemprop="articleBody">
            <script async type="text/javascript" src="https://cdn.carbonads.com/carbon.js?serve=CK7ITK3J&amp;placement=pythonpediacom" id="_carbonads_js"></script>


            <h2 id="syntax">Syntax</h2>
            <div>
                <ul>
<li>valgrind <em>program-name</em> <em>optional-arguments</em> &lt; <em>test input</em></li>
</ul>


            </div>


            <h2 id="remarks">Remarks</h2>
            <div>
                <p>Valgrind is a debugging tool that can be used to diagnose errors regarding memory management in C programs. Valgrind can be used to detect errors like invalid pointer usage, including writing or reading past the allocated space, or making an invalid call to <code>free()</code>. It can also be used for improving applications through functions that conduct memory profiling.</p>
<p>For more info see <a href="http://valgrind.org/" rel="nofollow noreferrer">http://valgrind.org</a>.</p>


            </div>


            <h2 id="adding-flags">Adding flags</h2>
            <div>
                <p>You can also turn on more tests, such as:</p>
<pre><code>valgrind -q --tool=memcheck --leak-check=yes ./my-program arg1 arg2 &lt; test-input
</code></pre>
<p>See valgrind --help for more information about the (many) options, or look at the documentation at <a href="http://valgrind.org/" rel="nofollow">http://valgrind.org/</a> for detailed information about what the output means.</p>


            </div>
            <h2 id="bytes-lost-forgetting-to-free">Bytes lost -- Forgetting to free</h2>
            <div>
                <p>Here is a program that calls malloc but not free:</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(int argc, char **argv)
{
    char *s;

    s = malloc(26); // the culprint 

    return 0;
}
</code></pre>
<p>With no extra arguments, valgrind will not look for this error.</p>
<p>But if we turn on <code>--leak-check=yes</code> or <code>--tool=memcheck</code>, it will complain and display the lines responsible for those memory leaks if the program was compiled in debug mode:</p>
<pre><code>$ valgrind -q --leak-check=yes ./missing_free
==4776== 26 bytes in 1 blocks are definitely lost in loss record 1 of 1
==4776==    at 0x4024F20: malloc (vg_replace_malloc.c:236)
==4776==    by 0x80483F8: main (missing_free.c:9)
==4776== 
</code></pre>
<p>If the program is not compiled in debug mode (for example with the <code>-g</code> flag in GCC) it will still show us where the leak happened in terms of the relevant function, but not the lines.</p>
<p>This lets us go back and look at what block was allocated in that line and try to trace forward to see why it wasn't freed.</p>


            </div>
            <h2 id="most-common-errors-encountered-while-using-valgrind">Most common errors encountered while using Valgrind</h2>
            <div>
                <p>Valgrind provides you with the <em>lines at which the error occurred</em> at the end of each line in the format <code>(file.c:line_no)</code>. Errors in valgrind are summarised in the following way:</p>
<pre><code>ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)
</code></pre>
<p>The most common errors include:</p>
<ol>
<li><strong>Illegal read/write errors</strong></li>
</ol>
<pre><code>==8451== Invalid read of size 2
==8451==    at 0x4E7381D: getenv (getenv.c:84)
==8451==    by 0x4EB1559: __libc_message (libc_fatal.c:80)
==8451==    by 0x4F5256B: __fortify_fail (fortify_fail.c:37)
==8451==    by 0x4F5250F: __stack_chk_fail (stack_chk_fail.c:28)
==8451==    by 0x40059C: main (valg.c:10)
==8451==  Address 0x700000007 is not stack'd, malloc'd or (recently) free'd
</code></pre>
<p>This happens when the code starts to access memory which does not belong to the program. The size of the memory accessed also gives you an indication of what variable was used.</p>
<ol start="2">
<li><strong>Use of Uninitialized Variables</strong></li>
</ol>
<pre><code>==8795== 1 errors in context 5 of 8:
==8795== Conditional jump or move depends on uninitialised value(s)
==8795==    at 0x4E881AF: vfprintf (vfprintf.c:1631)
==8795==    by 0x4E8F898: printf (printf.c:33)
==8795==    by 0x400548: main (valg.c:7)
</code></pre>
<p>According to the error, at line 7 of the <code>main</code> of <code>valg.c</code>, the call to <code>printf()</code> passed an uninitialized variable to <code>printf</code>.</p>
<ol start="3">
<li><strong>Illegal freeing of Memory</strong></li>
</ol>
<pre><code>==8954== Invalid free() / delete / delete[] / realloc()
==8954==    at 0x4C2EDEB: free (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==8954==    by 0x4005A8: main (valg.c:10)
==8954==  Address 0x5203040 is 0 bytes inside a block of size 240 free'd
==8954==    at 0x4C2EDEB: free (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==8954==    by 0x40059C: main (valg.c:9)
==8954==  Block was alloc'd at
==8954==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==8954==    by 0x40058C: main (valg.c:7)
</code></pre>
<p>According to valgrind, the code freed the memory illegally (a second time) at <em>line 10</em> of <code>valg.c</code>, whereas it was already freed at <em>line 9</em>, and the block itself was allocated memory at <em>line 7</em>.</p>


            </div>
            <h2 id="running-valgrind">Running Valgrind</h2>
            <div>
                <pre><code>valgrind ./my-program arg1 arg2 &lt; test-input
</code></pre>
<p>This will run your program and produce a report of any allocations and de-allocations it did. It will also warn you about common errors like using uninitialized memory, dereferencing pointers to strange places, writing off the end of blocks allocated using malloc, or failing to free blocks.</p>


            </div>
    </div>
   
    
    <hr/>
    <div class="paging">
        <div class="paging-previous">
                    <a href="../7645/unions.html">Previous Topic</a>
        </div>
        <div class="paging-next">
                <a href="../455/variable-arguments.html">Next Topic</a>
        </div>
    </div>
    <hr/>
    
    <div style="display: none">
        <div itemprop="author" itemscope itemtype="https://schema.org/Organization"><span itemprop="name">SO Community</span></div>
        <div itemprop="dateCreated">2016-07-22</div>
        <div itemprop="datePublished">2016-07-22</div>
        <div itemprop="dateModified">2017-06-23</div>
        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
            <span itemprop="url">http://i.stack.imgur.com/3bQIZ.png</span>
        </div>
        <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
            <span itemprop="name">C Language Pedia</span>
            <span itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
                <span itemprop="url">https://c.programmingpedia.net/favicon.ico</span>
            </span>
        </div>
    </div>
    <div class="box-copyright">
        <div>This modified text is an extract of the original Stack Overflow Documentation created by following <a href="https://riptutorial.com/contributor?topicId=2674" target="_blank">contributors</a> and released under <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC BY-SA 3.0</a></div>
        <div>This website is not affiliated with <a href="https://stackoverflow.com/" target="_blank">Stack Overflow</a></div>
        <div>Email: <a href="mailto: tutorialpedia@outlook.com">tutorialpedia@outlook.com</a></div>
    </div>
</div>


            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">


<ul id="accordion_280678010" class="nav-toc">
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#syntax">
                    Syntax
                </a>
            
        </li>
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#remarks">
                    Remarks
                </a>
            
        </li>
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#adding-flags">
                    Adding flags
                </a>
            
        </li>
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#bytes-lost-forgetting-to-free">
                    Bytes lost -- Forgetting to free
                </a>
            
        </li>
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#most-common-errors-encountered-while-using-valgrind">
                    Most common errors encountered while using Valgrind
                </a>
            
        </li>
        <li class="nav-toc-item   " >
                <a class="nav-toc-link" href="#running-valgrind">
                    Running Valgrind
                </a>
            
        </li>
</ul>

        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/tutorial/2674/valgrind by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 09:03:37 GMT -->
</html>
