<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/32037217/how-can-i-replace-delay---by-millis--- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:10:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="How can I replace delay() by millis()? | C Language Knowledge Base">
        <meta name="description" property="og:description" content="How can I replace delay() by millis()? | C Language Knowledge Base">
        <title>How can I replace delay() by millis()? | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="how-can-i-replace-delay-by-millis-">How can I replace delay() by millis()?</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/arduino.html">arduino</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/delay.html">delay</a></span>
                        <span class="tag-item"><a href="../tag/ide.html">ide</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>After a while, I get my final result I want but I can't use delay because I need different time for different strip, so I need to replace <code>delay()</code> by <code>millis()</code> in this code:</p>

<pre><code>#include &lt;FastLED.h&gt;
#define NUM_LEDS1 10
#define NUM_LEDS2 6
#define DATA_PIN1 6
#define DATA_PIN2 7
CRGB leds1[NUM_LEDS1];
CRGB leds2[NUM_LEDS2];

void setup() { 
  FastLED.addLeds&lt;NEOPIXEL, DATA_PIN1&gt;(leds1, NUM_LEDS1);
  FastLED.addLeds&lt;NEOPIXEL, DATA_PIN2&gt;(leds2, NUM_LEDS2);
}

int dot_delay1[ ] = { 100,200,300,400,500,600,700,800,900,1000 };
int dot_delay2[ ] = { 100,200,300,400,500,600 };

void loop() {
  for(int dot = 0; dot &lt; NUM_LEDS1; dot++)
    for(int dot = 0; dot &lt; NUM_LEDS2; dot++) 
    { 
      leds1[dot] = CRGB::Blue;
      leds2[dot] = CRGB::Blue;
      FastLED.show();
      leds1[dot] = CRGB::Black;
      leds2[dot] = CRGB::Black;
      delay( dot_delay1[ dot ] );
      // this is where I need to put the second delay,
      // but I can't put more then 1 delay.
      // I need to refactor my code with millis() function instead of delay()
    }
}
</code></pre>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/5232711/francois-eric-king" target="_blank"><span itemprop="name">Fran√ßois Eric King</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">1</div>
                                    <div itemprop="dateCreated">10/31/2016 4:34:26 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question second-answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div itemprop="text">
                                        <p>I see you're using NeoPixels! It just so happens that Adafruit has some great tutorials on using <code>millis()</code> and <code>micros()</code> for timing purposes instead of <code>delay()</code>. They also include good material on interrupts, if you're feeling ambitious and want to separate your timing from your main function entirely (a worthwhile undertaking, if you have the time and resources).</p>

<p>Part 1 (basics of using <code>millis()</code>):</p>

<p><a href="https://learn.adafruit.com/multi-tasking-the-arduino-part-1/overview" rel="nofollow">https://learn.adafruit.com/multi-tasking-the-arduino-part-1/overview</a></p>

<p>Part 2 (introduces interrupts):</p>

<p><a href="https://learn.adafruit.com/multi-tasking-the-arduino-part-2/overview" rel="nofollow">https://learn.adafruit.com/multi-tasking-the-arduino-part-2/overview</a></p>

<p>Part 3 (puts everything together):</p>

<p><a href="https://learn.adafruit.com/multi-tasking-the-arduino-part-3/overview" rel="nofollow">https://learn.adafruit.com/multi-tasking-the-arduino-part-3/overview</a></p>

<hr>

<h2 id="edit-1-">Edit 1:</h2>

<p>Alright, I edited your code, adding in a loop that checks for both delay periods to be done using <code>millis()</code>. I attempted to stick to the variable naming conventions that you've been using, for easy readability. There were also some other issues with your code syntax that I cleaned up. Make sure to effectively comment your code so that it's understandable, for yourself and for others!</p>

<p>Hopefully this works the way you want it to!</p>

<pre><code>/*The goal of the sketch is to run multiple strip where each dot could be 
controlled on/off one after the others but with different times on/off between each
pixel on each strip. All be independent and separate and automated and structured
already like FastLED library recommendation.*/

// Library include
#include &lt;FastLED.h&gt;

#define NUM_LEDS1 10
#define NUM_LEDS2 6

// Define pin (each strip be connected on)
#define DATA_PIN1 5
#define DATA_PIN2 6

// Declare some strip name and attribute (number of led per strip)
CRGB leds1[NUM_LEDS1];
CRGB leds2[NUM_LEDS2];

void setup() {
  FastLED.addLeds&lt;NEOPIXEL, DATA_PIN1&gt;(leds1, NUM_LEDS1);
  FastLED.addLeds&lt;NEOPIXEL, DATA_PIN2&gt;(leds2, NUM_LEDS2);
}

int dot_delay1[] = {100, 200, 300, 400, 500, 600, 700, 800, 900, 1000};
int dot_delay2[] = {100, 200, 300, 400, 500, 600};

void loop() {
  for (int dot1 = 0; dot1 &lt; NUM_LEDS1; dot1++) {
    for (int dot2 = 0; dot2 &lt; NUM_LEDS2; dot2++) {
      // LED turns blue
      leds1[dot1] = CRGB::Blue;
      leds2[dot2] = CRGB::Blue;
      // Show LED status
      FastLED.show();
      // LED turns black
      leds1[dot1] = CRGB::Black;
      leds2[dot2] = CRGB::Black;
      // Create timing variables
      unsigned long previousMillis = millis();
      unsigned long currentMillis = millis();
      // Create boolean variables to monitor if the delays have triggered yet
      bool delayFlag1 = false, delayFlag2 = false;
      // Loop continuously
      while (1) {
        currentMillis = millis();
        // If the first delay time has passed, delayFlag1 is true
        if ((unsigned long)(millis() - previousMillis) &gt;= dot_delay1[dot1]) {
          delayFlag1 = true;
        }
        // If the second delay time has passed, delayFlag2 is true
        if ((unsigned long)(millis() - previousMillis) &gt;= dot_delay2[dot2]) {
          delayFlag2 = true;
        }
        // If both delay times have passed (both delay flags are true), exit while loop
        if ((delayFlag1 &amp;&amp; delayFlag2) == true) {
          break;
        }
      }
    }
  }
}
</code></pre>

<p>This new code should work, I've tested it and it works as expected on my machine.</p>

<p>As a side note, your original question was "How can I replace delay() by millis()?". This question has been answered both by myself and by the previous answer author, user3704293. In the future it may be helpful to separate your questions to get higher quality answers and to better serve those who are searching for answers to the same questions. Once your question is answered, as I hope this question is now, you should accept the answer that is the best for you.</p>

<p>Let me know if it all works out!</p>

<hr>

<h2 id="edit-2-">Edit 2:</h2>

<p>To have LEDs change independently of each other, replace the <code>loop()</code> function in the previous code with this one.</p>

<pre><code>void loop() {
  // Create timing variable
  unsigned long previousMillis = millis();
  // Loop through all LEDs
  for (int dot = 0; dot &lt; NUM_LEDS1; dot++) {
    // If the first delay time has passed, change first LED strip
    if ((unsigned long)(millis() - previousMillis) &gt;= dot_delay1[dot1]) {
      leds1[dot - 1] = CRGB::Black;
      leds1[dot] = CRGB::Blue;
    }
    // If the second delay time has passed, change second LED strip
    if ((unsigned long)(millis() - previousMillis) &gt;= dot_delay2[dot2]) {
      leds2[dot - 1] = CRGB::Black;
      leds2[dot] = CRGB::Blue;
    }
    // Show LEDs
    FastLED.show();
  }
  // Turn last LED Black
  leds1[9] = CRGB::Black;
}
</code></pre>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/5154263/bk610" target="_blank"><span itemprop="name">BK610</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/32037217/how-can-i-replace-delay---by-millis---#answer-0</div>
                                            <div itemprop="upvoteCount">0</div>
                                            <div itemprop="dateCreated">8/21/2015 12:38:59 PM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/32037217" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/32037217/how-can-i-replace-delay---by-millis--- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:10:16 GMT -->
</html>
