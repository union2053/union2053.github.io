<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/22901901/what-does-fflush-stdin--do-in-c-programing- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:05:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="[SOLVED] What does fflush(stdin) do in C programing? | C Language Knowledge Base">
        <meta name="description" property="og:description" content="[SOLVED] What does fflush(stdin) do in C programing? | C Language Knowledge Base">
        <title>[SOLVED] What does fflush(stdin) do in C programing? | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="what-does-fflush-stdin-do-in-c-programing-">What does fflush(stdin) do in C programing?</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/operating-system.html">operating-system</a></span>
                        <span class="tag-item"><a href="../tag/signals.html">signals</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>I am very new to C programming and I am trying to understand how <code>fflush(stdin)</code> really works.</p>

<p>In the following example does <code>fflush(stdin)</code> clears all the buffer or it clears whatever entered after the third item? What I mean is user enters account number, space, name, space, balance. Is that true that from this point on, whatever the user enters will be flushed with <code>fflush(stdin)</code>?  and <code>stdin</code> won't be empty. </p>

<p>Why do I say that is because it enters into a while loop and starts writing to the text file.</p>

<p>My second question is whether <code>Ctrl-Z</code> will tell the OS to stop asking the user for entering input?</p>

<pre><code>printf( "Enter the account name and balance. (separated by spaces)\n" );
  printf( "Enter EOF to end input. (Ctrl-Z)\n" );
  printf( "? " );
  scanf( "%d%s%lf", &amp;account, name, &amp;balance );
  fflush(stdin);

  // write account, name and balance into file with fprintf
  while ( !feof( stdin ) )
  { 
     //fflush(stdin);
     fprintf( cfPtr, "%d %s %.2f\n", account, name, balance );
     printf( "? " );
     scanf( "%d%s%lf", &amp;account, name, &amp;balance );
  }

  fclose( cfPtr );
</code></pre>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/699559/c-graphics" target="_blank"><span itemprop="name">C graphics</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">19</div>
                                    <div itemprop="dateCreated">11/28/2017 3:25:28 PM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="accepted-answer">Accepted Answer</h3>
                                    <div itemprop="text">
                                        <p>Simple: this is undefined behavior, since <code>fflush</code> is meant to be called on an output stream. This is an excerpt from the C standard:</p>

<blockquote>
  <p>int fflush(FILE *ostream);</p>
  
  <p>ostream points to an output stream or
  an update stream in which the most
  recent operation was not input, the
  fflush function causes any unwritten
  data for that stream to be delivered
  to the host environment to be written
  to the file; otherwise, the behavior
  is undefined.</p>
</blockquote>

<p>So it's not a question of "how bad" this is. <code>fflush(stdin)</code> is <strong>plainly wrong</strong>, and you <strong>mustn't use it, ever</strong>.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/8206/eli-bendersky" target="_blank"><span itemprop="name">Eli Bendersky</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/22901901/what-does-fflush-stdin--do-in-c-programing-#answer-0</div>
                                            <div itemprop="upvoteCount">65</div>
                                            <div itemprop="dateCreated">6/5/2010 4:53:39 AM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                            <div id="answer-1" class="block-question second-answer" >
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div >
                                        <p><sup><em>Converting comments into an answer — and extending them since the issue reappears periodically.</em></sup></p>

<h2 id="standard-c-and-posix-leave-fflush-stdin-as-undefined-behaviour">Standard C and POSIX leave <code>fflush(stdin)</code> as undefined behaviour</h2>

<p>The <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/fflush.html">POSIX</a>, C and C++ standards for <code>fflush()</code> explicitly state that the behaviour is undefined, but none of them prevent a system from defining it.</p>

<p>ISO/IEC 9899:2011 — the C11 Standard — says:</p>

<blockquote>
  <h3 id="-7-21-5-2-the-fflush-function">§7.21.5.2 The fflush function</h3>
  
  <p>¶2 If <code>stream</code> points to an output stream or an update stream in which the most recent operation was not input, the <code>fflush</code> function causes any unwritten data for that stream to be delivered to the host environment to be written to the file; otherwise, the behavior is undefined.</p>
</blockquote>

<p>POSIX mostly defers to the C standard but it does mark this text as a C extension.</p>

<blockquote>
  <p>[CX] For a stream open for reading, if the file is not already at EOF, and the file is one capable of seeking, the file offset of the underlying open file description shall be set to the file position of the stream, and any characters pushed back onto the stream by <code>ungetc()</code> or <code>ungetwc()</code> that have not subsequently been read from the stream shall be discarded (without further changing the file offset).</p>
</blockquote>

<p>Note that terminals are not capable of seeking; neither are pipes or sockets.</p>

<h2 id="microsoft-defines-the-behaviour-of-fflush-stdin-">Microsoft defines the behaviour of <code>fflush(stdin)</code></h2>

<p><a href="http://msdn.microsoft.com/en-us/library/9yky46tz.aspx">Microsoft</a> and the Visual Studio runtime defines the define the behaviour of <code>fflush()</code> on an input stream.</p>

<blockquote>
  <p>If the stream is open for input, <code>fflush</code> clears the contents of the buffer.</p>
</blockquote>

<p><a href="https://stackoverflow.com/users/1505939/m-m">M.M</a> <a href="https://stackoverflow.com/questions/2979209/using-fflushstdin#comment40866432_2979209">notes</a>:</p>

<blockquote>
  <p>Cygwin is an example of a fairly common platform on which <code>fflush(stdin)</code> does not clear the input.</p>
</blockquote>

<p>This is why this answer version of my <a href="https://stackoverflow.com/questions/2979209/using-fflushstdin#comment31066899_2979209">comment</a> notes 'Microsoft and the Visual Studio runtime' — if you use a non-Microsoft C runtime library, the behaviour you see depends on that library.</p>

<h2 id="linux-documentation-and-practice-seem-to-contradict-each-other">Linux documentation and practice seem to contradict each other</h2>

<p>Surprisingly, <a href="http://linux.die.net/man/3/fflush">Linux</a> nominally documents the behaviour of <code>fflush(stdin)</code> too, and even defines it the same way (miracle of miracles).</p>

<blockquote>
  <p>For input streams, <code>fflush()</code> discards any buffered data that has been fetched from the underlying file, but has not been consumed by the application.</p>
</blockquote>

<p>I remain a bit puzzled and surprised at the Linux documentation saying that <code>fflush(stdin)</code> will work.
Despite that suggestion, it most usually does not work on Linux.  I just checked the documentation on Ubuntu 14.04 LTS; it says what is quoted above, but empirically, it does not work — at least when the input stream is a non-seekable device such as a terminal.</p>

<h3 id="demo-fflush-c"><code>demo-fflush.c</code></h3>

<pre><code>#include &lt;stdio.h&gt;

int main(void)
{
    int c;
    if ((c = getchar()) != EOF)
    {
        printf("Got %c; enter some new data\n", c);
        fflush(stdin);
    }
    if ((c = getchar()) != EOF)
        printf("Got %c\n", c);

    return 0;
}
</code></pre>

<h3 id="example-output">Example output</h3>

<pre><code>$ ./demo-fflush
Alliteration
Got A; enter some new data
Got l
$
</code></pre>

<p>This output was obtained on both Ubuntu 14.04 LTS and Mac OS X 10.11.2.  To my understanding, it contradicts what the Linux manual says.  If the <code>fflush(stdin)</code> operation worked, I would have to type a new line of text to get information for the second <code>getchar()</code> to read.</p>

<p>Given what the POSIX standard says, maybe a better demonstration is needed, and the Linux documentation should be clarified.</p>

<h3 id="demo-fflush2-c"><code>demo-fflush2.c</code></h3>

<pre><code>#include &lt;stdio.h&gt;

int main(void)
{
    int c;
    if ((c = getchar()) != EOF)
    {
        printf("Got %c\n", c);
        ungetc('B', stdin);
        ungetc('Z', stdin);
        if ((c = getchar()) == EOF)
        {
            fprintf(stderr, "Huh?!\n");
            return 1;
        }
        printf("Got %c after ungetc()\n", c);
        fflush(stdin);
    }
    if ((c = getchar()) != EOF)
        printf("Got %c\n", c);

    return 0;
}
</code></pre>

<h3 id="example-output">Example output</h3>

<p>Note that <code>/etc/passwd</code> is a seekable file.  On Ubuntu, the first line looks like:</p>

<pre><code>root:x:0:0:root:/root:/bin/bash
</code></pre>

<p>On Mac OS X, the first 4 lines look like:</p>

<pre><code>##
# User Database
# 
# Note that this file is consulted directly only when the system is running
</code></pre>

<p>In other words, there is commentary at the top of the Mac OS X <code>/etc/passwd</code> file.  The non-comment lines conform to the normal layout, so the <code>root</code> entry is:</p>

<pre><code>root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre>

<p>Ubuntu 14.04 LTS:</p>

<pre><code>$ ./demo-fflush2 &lt; /etc/passwd
Got r
Got Z after ungetc()
Got o
$ ./demo-fflush2
Allotrope
Got A
Got Z after ungetc()
Got B
$
</code></pre>

<p>Mac OS X 10.11.2:</p>

<pre><code>$ ./demo-fflush2 &lt; /etc/passwd
Got #
Got Z after ungetc()
Got B
$
</code></pre>

<p>The Mac OS X behaviour ignores (or at least seems to ignore) the <code>fflush(stdin)</code> (thus not following POSIX on this issue).  The Linux behaviour corresponds to the documented POSIX behaviour, but the POSIX specification is far more careful in what it says — it specifies a file capable of seeking, but terminals, of course, do not support seeking.  It is also much less useful than the Microsoft specification.</p>

<h2 id="summary">Summary</h2>

<p>Microsoft documents the behaviour of <code>fflush(stdin)</code>.  Apparently, it works as documented on the Windows platform, using the native Windows compiler and C runtime support libraries.</p>

<p>Despite documentation to the contrary, it does not work on Linux when the standard input is a terminal, but it seems to follow the POSIX specification which is far more carefully worded.  According to the C standard, the behaviour of <code>fflush(stdin)</code> is undefined.  POSIX adds the qualifier 'unless the input file is seekable', which a terminal is not.  The behaviour is not the same as Microsoft's.</p>

<p>Consequently, portable code does not use <code>fflush(stdin)</code>.  Code that is tied to Microsoft's platform may use it and it will work, but beware the portability issues.</p>

<h3 id="posix-way-to-discard-unread-terminal-input-from-a-file-descriptor">POSIX way to discard unread terminal input from a file descriptor</h3>

<p>The POSIX standard way to discard unread information from a terminal file descriptor (as opposed to a file stream like <code>stdin</code>) is illustrated at <a href="https://stackoverflow.com/questions/10938882/how-can-i-flush-unread-data-from-a-tty-input-queue-on-a-unix-system">How can I flush unread data from a tty input queue on a Unix system</a>.  However, that is operating below the standard I/O library level.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name"><a href="https://stackoverflow.com/users/15168/jonathan-leffler" target="_blank">Jonathan Leffler</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/22901901" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/22901901/what-does-fflush-stdin--do-in-c-programing- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:05:40 GMT -->
</html>
