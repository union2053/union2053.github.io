<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/56695786/code-porting-from-arduino-to-stm32f100-using-stm32cube-ide by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:16:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="Code porting from Arduino to stm32f100 using STM32Cube IDE | C Language Knowledge Base">
        <meta name="description" property="og:description" content="Code porting from Arduino to stm32f100 using STM32Cube IDE | C Language Knowledge Base">
        <title>Code porting from Arduino to stm32f100 using STM32Cube IDE | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="code-porting-from-arduino-to-stm32f100-using-stm32cube-ide">Code porting from Arduino to stm32f100 using STM32Cube IDE</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/arduino.html">arduino</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/cplusplus.html">c++</a></span>
                        <span class="tag-item"><a href="../tag/libraries.html">libraries</a></span>
                        <span class="tag-item"><a href="../tag/stm32.html">stm32</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>I have an Arduino sketch that work perfect on my Arduino Mega 2560 but I should port that code from the Arduino IDE to STM32Cube IDE (eclipse based) because I must use an stm32f100 for my project. I'm new on the stm32 world and not a veteran using eclipse based IDE so it's like I don't know what's the best way to make work the Arduino code on my stm32.
Considering that I'm using theese 2 libraries on the Arduino IDE:
<a href="https://github.com/olikraus/u8g2" rel="nofollow noreferrer">https://github.com/olikraus/u8g2</a> for drive my lcd;
<a href="https://github.com/smarmengol/Modbus-Master-Slave-for-Arduino" rel="nofollow noreferrer">https://github.com/smarmengol/Modbus-Master-Slave-for-Arduino</a> for the modbus protocol.
I need help to understand what's the best whay to port the code from Arduino to stm32:
How easy is to do this if it's possible?
May be better find different libraries written for the stm32 and basically change a lot of my previous code?
Take in consideration I'm not good using this eclipse based IDE and I have only few notions about HAL.
Thank you for helping me.</p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/9746409/simone-del-gobbo" target="_blank"><span itemprop="name">Simone Del Gobbo</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">1</div>
                                    <div itemprop="dateCreated">6/21/2019 1:32:29 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question second-answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div itemprop="text">
                                        <p>Although I have not used STM32CubeIDE yet, it is - AFAIK - essentially a combination of STM32CubeMX and Atollic Truestudio. My suggestions below are partly based on my experience with these.</p>

<p>Regarding drivers ... It is unlikely that the drivers you referred to - for the LCD and Modbus communication - will work without modification. Nonetheless, if you are not daunted by that fact, read on.</p>

<h1 id="start-simple">Start simple</h1>

<p>If you have never programmed for the STM32 before, it is best to start with something simple - before trying to implement or integrate an LCD driver and RS485 functionality. Walk before you run as they say.</p>

<p>Start by simply toggling an LED.</p>

<pre><code>while (1) {
   HAL_Delay(500);
   HAL_GPIO_TogglePin(MyLED_Port, MyLED_Pin);
}
</code></pre>

<p>Next try some UART communication. I personally prefer to use the low-level library for this - as it offers considerably more control for receiving serial data. Sending a byte over UART using the LL interface, for example, looks like</p>

<pre class="lang-c prettyprint-override"><code>uint8_t byte = 'a';
LL_USART_TransmitData8(USART2, byte);
</code></pre>

<p>Note that you should only use <code>LL_USART</code> routines in your code if you have initialized your USART peripheral using the LL interface. If you initialized it using the HAL interface, you should only use HAL routines throughout the code. You may find it easier to start with the HAL library.</p>

<p>By the way ... Some of the STM32 development boards offer serial communication via the USB port - which is extremely useful for prototyping and debugging.</p>

<h1 id="interrupts">Interrupts</h1>

<p>You will need to learn about interrupts - if you have not done so already. This will probably be important for UART / serial communication, for example.</p>

<p>To explain why interrupts are important in serial communication ...</p>

<p>Imagine that a byte arrives in your UART buffer, and you do not read it before the next byte arrives. In this case you will have a UART overrun error (a particular flag will be set in the status register for the peripheral in question). One of the best ways to mitigate against this is to use a UART receive interrupt - and to write to a circular buffer inside that interrupt.</p>

<p>The Arduino library handles this for you automatically. Both its <code>Serial.read()</code> and <code>Serial.print()</code> routines use interrupts behind the scenes, for example. If you switch to STM32CubeMX - using either the HAL or LL (Low-Level) interfaces - you will need to handle the interrupts yourself.</p>

<p>I can't emphasize enough how important it will be to learn about interrupts. Google is your friend.</p>

<h1 id="timers">Timers</h1>

<p>One of the most useful features of microcontrollers are their hardware timers. You will also want to learn about these in due course. Combined with interrupts they can be used for a wide variety of things.</p>

<h1 id="multi-tasking-and-concurrency">Multi-tasking and concurrency</h1>

<p>Unless you plan to use an RTOS such as FreeRTOS (I am not sure your STM32F100 device will have enough memory for that), you need to consider how you are going to handle multiple tasks - if you have more than one. Ideally, you do not want any of your tasks to be 'blocking'. Implementing your tasks as state machines is one way to achieve this.</p>

<p>You may already be doing this in your Arduino code - inside your <code>loop()</code> function. In any case, this could be a good opportunity to learn about the 'super loop architecture' and state machines.</p>

<h1 id="hal-or-ll-interface-">HAL or LL interface?</h1>

<p>You mentioned that you plan to use the HAL interface in your post. You may find, in due course, that the low-level (LL) driver is more versatile for certain peripherals (e.g. the UART). Whichever interface you use for a particular peripheral, bear in mind that you should not use a mix of both for the same peripheral. I.e., if you initialize a peripheral using the HAL library, don't attempt to use LL functions to interact with that peripheral later in the program. Once you have a chosen an interface for a peripheral, stick with it throughout your code.</p>

<h1 id="debugging-experience">Debugging experience</h1>

<p>If you are using a STM32 development board for prototyping, these typically have a built-in ST-Link device - and offer a good debugging experience out of the box. Compared to the Arduino, in fact, the debugging experience is <em>much better</em>. With the Arduino library you are relying on <code>Serial.print()</code> statements inserted throughout your code. With Truestudio / Eclipse / STM32CubeIDE + ST-Link device, you have a proper debugger - can insert breakpoints, view the call stack, inspect local and global variables, special function registers, etc..</p>

<p>So, even though the suggestions above might pose a steep learning curve, the debugger may at least make certain things easier - and help you to overcome any problems that arise.</p>

<h1 id="alternatives">Alternatives</h1>

<p>If the above all sounds like too much work - or too steep a learning curve - you could look in to <a href="https://github.com/stm32duino/Arduino_Core_STM32" rel="nofollow noreferrer">STM32duino</a> as someone suggested in the comments. I have no experience with this so can't comment.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/9112798/david-collins" target="_blank"><span itemprop="name">David Collins</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/56695786/code-porting-from-arduino-to-stm32f100-using-stm32cube-ide#answer-0</div>
                                            <div itemprop="upvoteCount">3</div>
                                            <div itemprop="dateCreated">6/21/2019 9:23:55 AM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/56695786" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/56695786/code-porting-from-arduino-to-stm32f100-using-stm32cube-ide by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:16:56 GMT -->
</html>
