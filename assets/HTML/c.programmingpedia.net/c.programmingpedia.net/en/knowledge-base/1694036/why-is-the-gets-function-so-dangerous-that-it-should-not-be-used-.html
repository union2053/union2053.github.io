<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/1694036/why-is-the-gets-function-so-dangerous-that-it-should-not-be-used- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:15:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="[SOLVED] Why is the gets function so dangerous that it should not be used? | C Language Knowledge Base">
        <meta name="description" property="og:description" content="[SOLVED] Why is the gets function so dangerous that it should not be used? | C Language Knowledge Base">
        <title>[SOLVED] Why is the gets function so dangerous that it should not be used? | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="why-is-the-gets-function-so-dangerous-that-it-should-not-be-used-">Why is the gets function so dangerous that it should not be used?</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/buffer-overflow.html">buffer-overflow</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/fgets.html">fgets</a></span>
                        <span class="tag-item"><a href="../tag/gets.html">gets</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>When I try to compile C code that uses the <code>gets()</code> function with GCC, I get this warning: </p>

<blockquote>
  <p>(.text+0x34): warning: the `gets' function is dangerous and should not be used.</p>
</blockquote>

<p>I remember this has something to do with stack protection and security, but I'm not sure exactly why.</p>

<p>How can I remove this warning and why is there such a warning about using <code>gets()</code>? </p>

<p>If <code>gets()</code> is so dangerous then why can't we remove it?</p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/196629/vinit-dhatrak" target="_blank"><span itemprop="name">vinit dhatrak</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">202</div>
                                    <div itemprop="dateCreated">6/9/2019 12:11:53 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="accepted-answer">Accepted Answer</h3>
                                    <div itemprop="text">
                                        <p>In order to use <code>gets</code> safely, you have to know exactly how many characters you will be reading, so that you can make your buffer large enough. You will only know that if you know exactly what data you will be reading.</p>

<p>Instead of using <code>gets</code>, you want to use <a href="http://en.cppreference.com/w/c/io/fgets" rel="noreferrer"><code>fgets</code></a>, which has the signature</p>

<pre><code>char* fgets(char *string, int length, FILE * stream);
</code></pre>

<p>(<code>fgets</code>, if it reads an entire line, will leave the <code>'\n'</code> in the string; you'll have to deal with that.)</p>

<p>It remained an official part of the language up to the 1999 ISO C standard, but
it was officially removed by the 2011 standard. Most C implementations still support it, but at least gcc issues a warning for any code that uses it.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/572/thomas-owens" target="_blank"><span itemprop="name">Thomas Owens</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/1694036/why-is-the-gets-function-so-dangerous-that-it-should-not-be-used-#answer-0</div>
                                            <div itemprop="upvoteCount">159</div>
                                            <div itemprop="dateCreated">2/5/2016 12:18:33 AM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                            <div id="answer-1" class="block-question second-answer" >
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div >
                                        <h1 id="why-is-gets-dangerous">Why is <code>gets()</code> dangerous</h1>

<p>The first internet worm (the <a href="https://en.wikipedia.org/wiki/Morris_worm" rel="noreferrer">Morris Internet Worm</a>) escaped about 30 years ago (1988-11-02), and it used <code>gets()</code> and a buffer overflow as one of its methods of propagating from system to system. The basic problem is that the function doesn't know how big the buffer is, so it continues reading until it finds a newline or encounters EOF, and may overflow the bounds of the buffer it was given.</p>

<p>You should forget you ever heard that <code>gets()</code> existed.</p>

<p>The C11 standard ISO/IEC 9899:2011 eliminated <code>gets()</code> as a standard function, which is A Good Thing™ (it was formally marked as 'obsolescent' and 'deprecated' in ISO/IEC 9899:1999/Cor.3:2007 — Technical Corrigendum 3 for C99, and then removed in C11).  Sadly, it will remain in libraries for many years (meaning 'decades') for reasons of backwards compatibility. If it were up to me, the implementation of <code>gets()</code> would become:</p>

<pre><code>char *gets(char *buffer)
{
    assert(buffer != 0);
    abort();
    return 0;
}
</code></pre>

<p>Given that your code will crash anyway, sooner or later, it is better to head the trouble off sooner rather than later.  I'd be prepared to add an error message: </p>

<pre><code>fputs("obsolete and dangerous function gets() called\n", stderr);
</code></pre>

<p>Modern versions of the Linux compilation system generates warnings if you link <code>gets()</code> — and also for some other functions that also have security problems (<code>mktemp()</code>, …).</p>

<h1 id="alternatives-to-gets-">Alternatives to <code>gets()</code></h1>

<h2 id="fgets-">fgets()</h2>

<p>As everyone else said, the canonical alternative to <code>gets()</code> is <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/fgets.html" rel="noreferrer"><code>fgets()</code></a> specifying <code>stdin</code> as the file stream.</p>

<pre><code>char buffer[BUFSIZ];

while (fgets(buffer, sizeof(buffer), stdin) != 0)
{
    ...process line of data...
}
</code></pre>

<p>What no-one else yet mentioned is that <code>gets()</code> does not include the newline but <code>fgets()</code> does.  So, you might need to use a wrapper around <code>fgets()</code> that deletes the newline:</p>

<pre><code>char *fgets_wrapper(char *buffer, size_t buflen, FILE *fp)
{
    if (fgets(buffer, buflen, fp) != 0)
    {
        size_t len = strlen(buffer);
        if (len &gt; 0 &amp;&amp; buffer[len-1] == '\n')
            buffer[len-1] = '\0';
        return buffer;
    }
    return 0;
}
</code></pre>

<p>Or, better:</p>

<pre><code>char *fgets_wrapper(char *buffer, size_t buflen, FILE *fp)
{
    if (fgets(buffer, buflen, fp) != 0)
    {
        buffer[strcspn(buffer, "\n")] = '\0';
        return buffer;
    }
    return 0;
}
</code></pre>

<p>Also, as <a href="https://stackoverflow.com/users/134633/caf">caf</a> points out in a comment and <a href="https://stackoverflow.com/users/14860/paxdiablo">paxdiablo</a> shows in his answer, with <code>fgets()</code> you might have data left over on a line.  My wrapper code leaves that data to be read next time; you can readily modify it to gobble the rest of the line of data if you prefer:</p>

<pre><code>        if (len &gt; 0 &amp;&amp; buffer[len-1] == '\n')
            buffer[len-1] = '\0';
        else
        {
             int ch;
             while ((ch = getc(fp)) != EOF &amp;&amp; ch != '\n')
                 ;
        }
</code></pre>

<p>The residual problem is how to report the three different result states — EOF or error, line read and not truncated, and partial line read but data was truncated.</p>

<p>This problem doesn't arise with <code>gets()</code> because it doesn't know where your buffer ends and merrily tramples beyond the end, wreaking havoc on your beautifully tended memory layout, often messing up the return stack (a <a href="https://stackoverflow.com/">Stack Overflow</a>) if the buffer is allocated on the stack, or trampling over the control information if the buffer is dynamically allocated, or copying data over other precious global (or module) variables if the buffer is statically allocated.  None of these is a good idea — they epitomize the phrase 'undefined behaviour`.</p>

<hr>

<p>There is also the <a href="https://stackoverflow.com/questions/372980/do-you-use-the-tr-24731-safe-functions-in-your-c-code">TR 24731-1</a> (Technical Report from the C Standard Committee) which provides safer alternatives to a variety of functions, including <code>gets()</code>:</p>

<blockquote>
  <h2 id="-6-5-4-1-the-gets-s-function">§6.5.4.1 The <code>gets_s</code> function</h2>
  
  <h3 id="synopsis">Synopsis</h3>

<pre><code>#define __STDC_WANT_LIB_EXT1__ 1
#include &lt;stdio.h&gt;
char *gets_s(char *s, rsize_t n);
</code></pre>
  
  <h3 id="runtime-constraints">Runtime-constraints</h3>
  
  <p><code>s</code> shall not be a null pointer. <code>n</code> shall neither be equal to zero nor be greater than
  RSIZE_MAX. A new-line character, end-of-file, or read error shall occur within reading
  <code>n-1</code> characters from <code>stdin</code>.<sup>25)</sup></p>
  
  <p>3 If there is a runtime-constraint violation, <code>s[0]</code> is set to the null character, and characters
  are read and discarded from <code>stdin</code> until a new-line character is read, or end-of-file or a
  read error occurs.</p>
  
  <h3 id="description">Description</h3>
  
  <p>4 The <code>gets_s</code> function reads at most one less than the number of characters specified by <code>n</code>
  from the stream pointed to by <code>stdin</code>, into the array pointed to by <code>s</code>. No additional
  characters are read after a new-line character (which is discarded) or after end-of-file.
  The discarded new-line character does not count towards number of characters read. A
  null character is written immediately after the last character read into the array.</p>
  
  <p>5 If end-of-file is encountered and no characters have been read into the array, or if a read
  error occurs during the operation, then <code>s[0]</code> is set to the null character, and the other
  elements of <code>s</code> take unspecified values.</p>
  
  <h3 id="recommended-practice">Recommended practice</h3>
  
  <p>6 The <code>fgets</code> function allows properly-written programs to safely process input lines too
  long to store in the result array. In general this requires that callers of <code>fgets</code> pay
  attention to the presence or absence of a new-line character in the result array. Consider
  using <code>fgets</code> (along with any needed processing based on new-line characters) instead of
  <code>gets_s</code>.</p>
  
  <p><sup>25)</sup> The <code>gets_s</code> function, unlike <code>gets</code>, makes it a runtime-constraint violation for a line of input to
  overflow the buffer to store it. Unlike <code>fgets</code>, <code>gets_s</code> maintains a one-to-one relationship between
  input lines and successful calls to <code>gets_s</code>. Programs that use <code>gets</code> expect such a relationship.</p>
</blockquote>

<p>The Microsoft Visual Studio compilers implement an approximation to the TR 24731-1 standard, but there are differences between the signatures implemented by Microsoft and those in the TR.</p>

<p>The C11 standard, ISO/IEC 9899-2011, includes TR24731 in Annex K as an optional part of the library. Unfortunately, it is seldom implemented on Unix-like systems.</p>

<hr>

<h2 id="getline-posix"><code>getline()</code> — POSIX</h2>

<p>POSIX 2008 also provides a safe alternative to <code>gets()</code> called <a href="http://www.opengroup.org/onlinepubs/9699919799/functions/getline.html" rel="noreferrer"><code>getline()</code></a>.  It allocates space for the line dynamically, so you end up needing to free it.  It removes the limitation on line length, therefore. It also returns the length of the data that was read, or <code>-1</code> (and not <code>EOF</code>!), which means that null bytes in the input can be handled reliably.  There is also a 'choose your own single-character delimiter' variation called <code>getdelim()</code>; this can be useful if you are dealing with the output from <code>find -print0</code> where the ends of the file names are marked with an ASCII NUL <code>'\0'</code> character, for example.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name"><a href="https://stackoverflow.com/users/15168/jonathan-leffler" target="_blank">Jonathan Leffler</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/1694036" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/1694036/why-is-the-gets-function-so-dangerous-that-it-should-not-be-used- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:15:40 GMT -->
</html>
