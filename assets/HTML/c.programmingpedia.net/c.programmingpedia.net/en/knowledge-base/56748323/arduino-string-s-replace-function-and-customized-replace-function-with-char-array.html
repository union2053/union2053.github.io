<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/56748323/arduino-string-s-replace-function-and-customized-replace-function-with-char-array by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:17:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="[SOLVED] Arduino String&#39;s replace function and customized replace function with char array | C Language Knowledge Base">
        <meta name="description" property="og:description" content="[SOLVED] Arduino String&#39;s replace function and customized replace function with char array | C Language Knowledge Base">
        <title>[SOLVED] Arduino String&#39;s replace function and customized replace function with char array | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="arduino-string-s-replace-function-and-customized-replace-function-with-char-array">Arduino String's replace function and customized replace function with char array</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/arduino.html">arduino</a></span>
                        <span class="tag-item"><a href="../tag/arrays.html">arrays</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/stm32.html">stm32</a></span>
                        <span class="tag-item"><a href="../tag/string.html">string</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>I'm planning to alternate some string operations, especially 'replace'. I saw some articles about String type's efficiency in Arduino(for example, <a href="https://hackingmajenkoblog.wordpress.com/2016/02/04/the-evils-of-arduino-strings/" rel="nofollow noreferrer">https://hackingmajenkoblog.wordpress.com/2016/02/04/the-evils-of-arduino-strings/</a>). Of course just using String is not troublesome but I thought about the time-efficiency of String object. So I tried to process replacement of the string with only character arrays.</p>

<p>First of all, I made a 'replace' function using only some of 'character arrays'. And then, I tried to compare with traditional String operations by executing very many same oprations. I do not think the two code is exactly same because of some of calloc(), but to use the function I thought calloc() is essential for my function.</p>

<p>I used Nucleo-K432LC evaluation board and Arduino 1.8.9.</p>

<pre><code>#define strpos(A, B) (int) (strstr(A, B) - A)

char* replace_char(char* dst, char* needle, char* replacer) {
    int offset;
    int k;
    int ns, rep;
    char* temp;
    if (strlen(dst) + strlen(needle) &lt; strlen(replacer) + strlen(dst)) {
        ns = strlen(replacer) - strlen(needle) + strlen(dst) + 1; rep = 1;
    }
    else {
        ns = strlen(dst) + strlen(needle) + 1; rep = 0;
    }
    temp = (char*)calloc(ns, sizeof(char));
    strcpy(temp, dst);
    if ((offset = strpos(dst, needle)) &lt; 0) return NULL;
    for (k = 0; (k &lt; strlen(replacer)) &amp;&amp; replacer[k] != '\0'; ++k)
        temp[k + offset] = replacer[k];
    for (k += offset; k &lt; strlen(replacer) - strlen(needle) + strlen(rep ? dst : temp); ++k)
        temp[k] = dst[k - strlen(replacer) + strlen(needle)];
    temp[k] = '\0';
    if (strpos(temp, needle) &lt; 0) {
        dst = temp;
        return temp;
    }
    else
        return replace_char(temp, needle, replacer);
}

void setup() {
    Serial.begin(115200);
    pinMode(LED_BUILTIN, OUTPUT);
}

void loop() {
    unsigned long t0 = millis();

    for (int k = 0; k &lt; 10000; ++k) {
        char* str = (char*) calloc(16, sizeof(char));
        char* str2 = "NANA";
        char* str3 = "1234KAHCS1234";
        strcat(str, "KKNANAHAHACA");
        char* newstr = replace_char(str, str2, str3);
        if (k &gt;= 9999)
            Serial.println(newstr);
        free(str);
        free(newstr);
    }
    Serial.println(millis() - t0);

    unsigned long t1 = millis();
    for (int k = 0; k &lt; 10000; ++k) {
        String str = "";
        String str2 = "NANA";
        String str3 = "1234KAHCS1234";
        str.concat("KKNANAHAHACA");
        str.replace(str2, str3);
        if (k &gt;= 9999)
            Serial.println(str);
    }
    Serial.println(millis() - t1);

    digitalWrite(LED_BUILTIN, !digitalRead(LED_BUILTIN));
    delay(1000);
}
</code></pre>

<p>My STM32 said that character array using one delayed 600ms, and using string caused 468ms delay. The final results are same for two operations.
I tried to shorten the lengths of arguments, and the function seemed to work successfully. However the speed was slower at character-array-based operations. Also it seemed that there was no error for string-based operations. I ran the sketch for one day, but I failed to found any case of 'efficiency'. Did I mis-focused? Using character-array-based would be better than string-based operations? Or, is the reduction of speed caused by solely due to lack of my programming experience?</p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/11316562/chanho-jeon" target="_blank"><span itemprop="name">Chanho Jeon</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">0</div>
                                    <div itemprop="dateCreated">6/25/2019 6:51:39 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="accepted-answer">Accepted Answer</h3>
                                    <div itemprop="text">
                                        <p>Your function is just horrible written. It is so bad - that even it does not make any sense to analyze it. BTW forget the recursion in the uC development.  Always think about the algorithm. Here you have much simpler and definitely more efficient:</p>

<pre><code>char *findAndReplace(char *haystack, const char *needle, const char *repl)
{
    size_t needle_len;
    size_t repl_len;
    size_t haystack_len;
    const char *pos = strstr(haystack, needle);

    if(pos)
    {
        needle_len = strlen(needle);
        repl_len = strlen(repl);
        haystack_len = strlen(haystack);

        if(needle_len != repl_len)
        {
            memmove((void *)(pos + repl_len), (void *)(pos + needle_len), haystack_len - (pos - haystack) + 1);
        }

        memcpy((void *)pos, (void *)repl, repl_len);
    }
    return haystack;
}
</code></pre>

<p>of course the haystack has to be:</p>

<ol>
<li>modifiable </li>
<li>big enough to accommodate the amended string</li>
</ol>

<blockquote>
  <p>but to use the function I thought calloc() is essential for my function.</p>
</blockquote>

<p>Forget about malloc and friends when programming uCs.  Otherwise you will get into serious problems. Dynamic memory allocation in the low memory enronments is a bit tricky , and "big computer" mechanisms fail miserably here</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/6110094/p--j--" target="_blank"><span itemprop="name">P__J__</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/56748323/arduino-string-s-replace-function-and-customized-replace-function-with-char-array#answer-0</div>
                                            <div itemprop="upvoteCount">1</div>
                                            <div itemprop="dateCreated">6/25/2019 12:46:01 PM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/56748323" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/56748323/arduino-string-s-replace-function-and-customized-replace-function-with-char-array by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:17:02 GMT -->
</html>
