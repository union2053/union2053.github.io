<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/11815894/how-to-read-write-arbitrary-bits-in-c-cplusplus by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:11:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="[SOLVED] How to read/write arbitrary bits in C/C++ | C Language Knowledge Base">
        <meta name="description" property="og:description" content="[SOLVED] How to read/write arbitrary bits in C/C++ | C Language Knowledge Base">
        <title>[SOLVED] How to read/write arbitrary bits in C/C++ | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="how-to-read-write-arbitrary-bits-in-c-cplusplus">How to read/write arbitrary bits in C/C++</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/bit.html">bit</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/cplusplus.html">c++</a></span>
                        <span class="tag-item"><a href="../tag/memory.html">memory</a></span>
                        <span class="tag-item"><a href="../tag/read-write.html">read-write</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>Assuming I have a byte b with the binary value of 11111111</p>

<p>How do I for example read a 3 bit integer value starting at the second bit or write a four bit integer value starting at the fifth bit?</p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/991484/dtech" target="_blank"><span itemprop="name">dtech</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">30</div>
                                    <div itemprop="dateCreated">2/23/2015 11:05:27 PM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="accepted-answer">Accepted Answer</h3>
                                    <div itemprop="text">
                                        <p>Some 2+ years after I asked this question I'd like to explain it the way I'd want it explained back when I was still a complete newb and would be most beneficial to people who want to understand the process.</p>

<p>First of all, forget the "11111111" example value, which is not really all that suited for the visual explanation of the process. So let the initial value be <code>10111011</code> (187 decimal) which will be a little more illustrative of the process.</p>

<p><strong>1 - how to read a 3 bit value starting from the second bit:</strong></p>

<pre><code>    ___  &lt;- those 3 bits
10111011 
</code></pre>

<p>The value is 101, or 5 in decimal, there are 2 possible ways to get it:</p>

<ul>
<li>mask and shift</li>
</ul>

<p>In this approach, the needed bits are first masked with the value <code>00001110</code> (14 decimal) after which it is shifted in place:</p>

<pre><code>    ___
10111011 AND
00001110 =
00001010 &gt;&gt; 1 =
     ___
00000101
</code></pre>

<p>The expression for this would be: <code>(value &amp; 14) &gt;&gt; 1</code></p>

<ul>
<li>shift and mask</li>
</ul>

<p>This approach is similar, but the order of operations is reversed, meaning the original value is shifted and then masked with <code>00000111</code> (7) to only leave the last 3 bits:</p>

<pre><code>    ___
10111011 &gt;&gt; 1
     ___
01011101 AND
00000111
00000101
</code></pre>

<p>The expression for this would be: <code>(value &gt;&gt; 1) &amp; 7</code></p>

<p>Both approaches involve the same amount of complexity, and therefore will not differ in performance.</p>

<p><strong>2 - how to write a 3 bit value starting from the second bit:</strong></p>

<p>In this case, the initial value is known, and when this is the case in code, you may be able to come up with a way to set the known value to another known value which uses less operations, but in reality this is rarely the case, most of the time the code will know neither the initial value, nor the one which is to be written.</p>

<p>This means that in order for the new value to be successfully "spliced" into byte, the target bits must be set to zero, after which the shifted value is "spliced" in place, which is the first step:</p>

<pre><code>    ___ 
10111011 AND
11110001 (241) =
10110001 (masked original value)
</code></pre>

<p>The second step is to shift the value we want to write in the 3 bits, say we want to change that from 101 (5) to 110 (6)</p>

<pre><code>     ___
00000110 &lt;&lt; 1 =
    ___
00001100 (shifted "splice" value)
</code></pre>

<p>The third and final step is to splice the masked original value with the shifted "splice" value:</p>

<pre><code>10110001 OR
00001100 =
    ___
10111101
</code></pre>

<p>The expression for the whole process would be: <code>(value &amp; 241) | (6 &lt;&lt; 1)</code></p>

<p><strong>Bonus - how to generate the read and write masks:</strong></p>

<p>Naturally, using a binary to decimal converter is far from elegant, especially in the case of 32 and 64 bit containers - decimal values get crazy big. It is possible to easily generate the masks with expressions, which the compiler can efficiently resolve during compilation:</p>

<ul>
<li>read mask for "mask and shift": <code>((1 &lt;&lt; fieldLength) - 1) &lt;&lt; (fieldIndex - 1)</code>, assuming that the index at the first bit is 1 (not zero)</li>
<li>read mask for "shift and mask": <code>(1 &lt;&lt; fieldLength) - 1</code> (index does not play a role here since it is always shifted to the first bit</li>
<li>write mask : just invert the "mask and shift" mask expression with the <code>~</code> operator</li>
</ul>

<p>How does it work (with the 3bit field beginning at the second bit from the examples above)?</p>

<pre><code>00000001 &lt;&lt; 3
00001000  - 1
00000111 &lt;&lt; 1
00001110  ~ (read mask)
11110001    (write mask)
</code></pre>

<p>The same examples apply to wider integers and arbitrary bit width and position of the fields, with the shift and mask values varying accordingly.</p>

<p>Also note that the examples assume unsigned integer, which is what you want to use in order to use integers as portable bit-field alternative (regular bit-fields are in no way guaranteed by the standard to be portable), both left and right shift insert a padding 0, which is not the case with right shifting a signed integer.</p>

<p><strong>Even easier:</strong></p>

<p>Using this set of macros (but only in C++ since it relies on the generation of member functions):</p>

<pre><code>#define GETMASK(index, size) (((1 &lt;&lt; (size)) - 1) &lt;&lt; (index))
#define READFROM(data, index, size) (((data) &amp; GETMASK((index), (size))) &gt;&gt; (index))
#define WRITETO(data, index, size, value) ((data) = ((data) &amp; (~GETMASK((index), (size)))) | ((value) &lt;&lt; (index)))
#define FIELD(data, name, index, size) \
  inline decltype(data) name() { return READFROM(data, index, size); } \
  inline void set_##name(decltype(data) value) { WRITETO(data, index, size, value); }
</code></pre>

<p>You could go for something as simple as:</p>

<pre><code>struct A {
  uint bitData;
  FIELD(bitData, one, 0, 1)
  FIELD(bitData, two, 1, 2)
};
</code></pre>

<p>And have the bit fields implemented as properties you can easily access:</p>

<pre><code>A a;
a.set_two(3);
cout &lt;&lt; a.two();
</code></pre>

<p>Replace <code>decltype</code> with gcc's <code>typeof</code> pre-C++11.</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/991484/dtech" target="_blank"><span itemprop="name">dtech</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/11815894/how-to-read-write-arbitrary-bits-in-c-cplusplus#answer-0</div>
                                            <div itemprop="upvoteCount">103</div>
                                            <div itemprop="dateCreated">7/6/2015 8:08:04 PM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                            <div id="answer-1" class="block-question second-answer" >
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div >
                                        <p>You need to shift and mask the value, so for example...</p>

<p>If you want to read the first two bits, you just need to mask them off like so:</p>

<pre><code>int value = input &amp; 0x3;
</code></pre>

<p>If you want to offset it you need to shift right N bits and then mask off the bits you want:</p>

<pre><code>int value = (intput &gt;&gt; 1) &amp; 0x3;
</code></pre>

<p>To read three bits like you asked in your question.</p>

<pre><code>int value = (input &gt;&gt; 1) &amp; 0x7;
</code></pre>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name"><a href="https://stackoverflow.com/users/637874/geoffrey" target="_blank">Geoffrey</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/11815894" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/11815894/how-to-read-write-arbitrary-bits-in-c-cplusplus by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:11:04 GMT -->
</html>
