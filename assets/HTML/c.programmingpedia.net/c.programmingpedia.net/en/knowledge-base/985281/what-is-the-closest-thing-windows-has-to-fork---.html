<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/985281/what-is-the-closest-thing-windows-has-to-fork--- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:05:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="[SOLVED] What is the closest thing windows has to fork()? | C Language Knowledge Base">
        <meta name="description" property="og:description" content="[SOLVED] What is the closest thing windows has to fork()? | C Language Knowledge Base">
        <title>[SOLVED] What is the closest thing windows has to fork()? | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="what-is-the-closest-thing-windows-has-to-fork-">What is the closest thing windows has to fork()?</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/cplusplus.html">c++</a></span>
                        <span class="tag-item"><a href="../tag/fork.html">fork</a></span>
                        <span class="tag-item"><a href="../tag/windows.html">windows</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>I guess the question says it all.</p>

<p>I want to fork on windows. What is the most similar operation and how do I use it.</p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/72631/rlbond" target="_blank"><span itemprop="name">rlbond</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">113</div>
                                    <div itemprop="dateCreated">6/12/2009 6:36:21 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="accepted-answer">Accepted Answer</h3>
                                    <div itemprop="text">
                                        <p><a href="http://www.cygwin.com/" rel="noreferrer">Cygwin</a> has fully featured fork() on Windows. Thus if using Cygwin is acceptable for you, then the problem is solved in the case performance is not an issue.</p>

<p>Otherwise you can take a look at how Cygwin implements fork(). From a quite old Cygwin's architecture <a href="http://www.redhat.com/support/wpapers/cygnus/cygnus_cygwin/architecture.html" rel="noreferrer">doc</a>:</p>

<blockquote>
  <p>5.6. Process Creation 
  The fork call in Cygwin is particularly interesting
  because it does not map well on top of
  the Win32 API. This makes it very
  difficult to implement correctly.
  Currently, the Cygwin fork is a
  non-copy-on-write implementation
  similar to what was present in early
  flavors of UNIX.</p>
  
  <p>The first thing that happens when a
  parent process forks a child process
  is that the parent initializes a space
  in the Cygwin process table for the
  child. It then creates a suspended
  child process using the Win32
  CreateProcess call. Next, the parent
  process calls setjmp to save its own
  context and sets a pointer to this in
  a Cygwin shared memory area (shared
  among all Cygwin tasks). It then fills
  in the child's .data and .bss sections
  by copying from its own address space
  into the suspended child's address
  space. After the child's address space
  is initialized, the child is run while
  the parent waits on a mutex. The child
  discovers it has been forked and
  longjumps using the saved jump buffer.
  The child then sets the mutex the
  parent is waiting on and blocks on
  another mutex. This is the signal for
  the parent to copy its stack and heap
  into the child, after which it
  releases the mutex the child is
  waiting on and returns from the fork
  call. Finally, the child wakes from
  blocking on the last mutex, recreates
  any memory-mapped areas passed to it
  via the shared area, and returns from
  fork itself.</p>
  
  <p>While we have some ideas as to how to
  speed up our fork implementation by
  reducing the number of context
  switches between the parent and child
  process, fork will almost certainly
  always be inefficient under Win32.
  Fortunately, in most circumstances the
  spawn family of calls provided by
  Cygwin can be substituted for a
  fork/exec pair with only a little
  effort. These calls map cleanly on top
  of the Win32 API. As a result, they
  are much more efficient. Changing the
  compiler's driver program to call
  spawn instead of fork was a trivial
  change and increased compilation
  speeds by twenty to thirty percent in
  our tests.</p>
  
  <p>However, spawn and exec present their
  own set of difficulties. Because there
  is no way to do an actual exec under
  Win32, Cygwin has to invent its own
  Process IDs (PIDs). As a result, when
  a process performs multiple exec
  calls, there will be multiple Windows
  PIDs associated with a single Cygwin
  PID. In some cases, stubs of each of
  these Win32 processes may linger,
  waiting for their exec'd Cygwin
  process to exit.</p>
</blockquote>

<p>Sounds like a lot of work, doesn't it? And yes, it is slooooow.</p>

<p>EDIT: the doc is outdated, please see this excellent <a href="https://stackoverflow.com/questions/985281/what-is-the-closest-thing-windows-has-to-fork/985525#985525">answer</a> for an update</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/80458/laurynas-biveinis" target="_blank"><span itemprop="name">Laurynas Biveinis</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/985281/what-is-the-closest-thing-windows-has-to-fork---#answer-0</div>
                                            <div itemprop="upvoteCount">79</div>
                                            <div itemprop="dateCreated">5/23/2017 12:34:37 PM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                            <div id="answer-1" class="block-question second-answer" >
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div >
                                        <p>I certainly don't know the details on this because I've never done it it, but the native NT API has a capability to fork a process (the POSIX subsystem on Windows needs this capability - I'm not sure if the POSIX subsystem is even supported anymore).</p>

<p>A search for ZwCreateProcess() should get you some more details - for example <a href="https://groups.google.com/forum/#!topic/comp.os.ms-windows.programmer.nt.kernel-mode/hoN_RYtnp58" rel="noreferrer">this bit of information from Maxim Shatskih</a>:</p>

<blockquote>
  <p>The most important parameter here is SectionHandle. If this parameter
  is NULL, the kernel will fork the current process. Otherwise, this
  parameter must be a handle of the SEC_IMAGE section object created on
  the EXE file before calling ZwCreateProcess().</p>
</blockquote>

<p>Though note that <a href="https://groups.google.com/forum/#!topic/microsoft.public.win32.programmer.kernel/ejtHCZmdyaI" rel="noreferrer">Corinna Vinschen indicates that Cygwin found using ZwCreateProcess() still unreliable</a>:</p>

<blockquote>
  <p>Iker Arizmendi wrote:</p>
  
   <pre class="lang-none prettyprint-override"><code>&gt; Because the Cygwin project relied solely on Win32 APIs its fork
&gt; implementation is non-COW and inefficient in those cases where a fork
&gt; is not followed by exec.  It's also rather complex. See here (section
&gt; 5.6) for details:
&gt;  
&gt; http://www.redhat.com/support/wpapers/cygnus/cygnus_cygwin/architecture.html
</code></pre>
  
  <p>This document is rather old, 10 years or so.  While we're still using
  Win32 calls to emulate fork, the method has changed noticably.
  Especially, we don't create the child process in the suspended state
  anymore, unless specific datastructes need a special handling in the
  parent before they get copied to the child.  In the current 1.5.25
  release the only case for a suspended child are open sockets in the
  parent.  The upcoming 1.7.0 release will not suspend at all.</p>
  
  <p>One reason not to use ZwCreateProcess was that up to the 1.5.25
  release we're still supporting Windows 9x users.  However, two
  attempts to use ZwCreateProcess on NT-based systems failed for one
  reason or another.</p>
  
  <p>It would be really nice if this stuff would be better or at all
  documented, especially a couple of datastructures and how to connect a
  process to a subsystem.  While fork is not a Win32 concept, I don't
  see that it would be a bad thing to make fork easier to implement.</p>
</blockquote>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name"><a href="https://stackoverflow.com/users/12711/michael-burr" target="_blank">Michael Burr</a></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/985281" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/985281/what-is-the-closest-thing-windows-has-to-fork--- by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:05:09 GMT -->
</html>
