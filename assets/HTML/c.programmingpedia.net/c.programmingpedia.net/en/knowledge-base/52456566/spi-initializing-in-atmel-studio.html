<!DOCTYPE html>



<html lang="en" itemscope="" itemtype="http://schema.org/QAPage">

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/52456566/spi-initializing-in-atmel-studio by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:14:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- webmaster tools -->
        <meta name="google-site-verification" content="" />
        <!-- Open Graph Tags -->
        <meta name="title" property="og:title" content="SPI initializing in Atmel studio | C Language Knowledge Base">
        <meta name="description" property="og:description" content="SPI initializing in Atmel studio | C Language Knowledge Base">
        <title>SPI initializing in Atmel studio | C Language Knowledge Base</title>

    

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    
        <style>
            body{margin:0;}img{max-width:100%;}ul{margin-top:0;margin-bottom:1rem;}.list-inline{padding-left:0;list-style:none;}.list-inline-item{display:inline-block;}.list-inline-item:not(:last-child){margin-right:.5rem;}.site-header{display:flex;height:60px;}.site-main,.site-footer{display:flex;}.col-aside-left-and-sidebar .col-aside-left,.col-sidebar,.col-content,.col-aside-right{position:relative;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{height:60px;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner{position:fixed;z-index:1;}.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{height:calc(100vh - 60px);position:fixed;}.site-main .col-sidebar-overflow{height:calc(100vh - 60px);position:relative;overflow-x:hidden;overflow-y:auto;}.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 450px);}.col-aside-left,.col-aside-left-inner{width:calc(50% - 750px);}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content,.col-content-inner{width:1200px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 750px);}@media(max-width:1869px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 500px);}.col-aside-left,.col-aside-left-inner{display:none;}.col-sidebar,.col-sidebar-inner{width:calc(50% - 500px);}.col-content,.col-content-inner{width:1000px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 500px);}}@media(max-width:1549px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:calc(50% - 400px);}.col-sidebar,.col-sidebar-inner{width:calc(50% - 400px);}.col-content,.col-content-inner{width:800px;}.col-aside-right,.col-aside-right-inner{width:calc(50% - 400px);}}@media(max-width:1229px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:300px;}.col-sidebar,.col-sidebar-inner{width:300px;}.col-content{width:calc(100% - 300px);}.col-content-inner{width:100%;}.col-aside-right,.col-aside-right-inner{display:none;}}@media(max-width:1000px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{width:250px;}.col-sidebar,.col-sidebar-inner{width:250px;}.col-content{width:calc(100% - 250px);}}@media(max-width:767px){.col-aside-left-and-sidebar,.col-aside-left-and-sidebar-inner{display:none;}.col-sidebar,.col-sidebar-inner{display:none;}.col-content{width:100%;}.site-main{display:initial;}.site-main .col-sidebar,.site-main .col-sidebar-inner{display:initial;width:100%;position:relative;}.site-main .col-sidebar-overflow{height:calc(30vh);}}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-header .col-content-inner{box-shadow:rgba(116,129,141,.1) 0 3px 8px 0;border-bottom:1px solid #d4dadf;}.site-header .col-aside-left-and-sidebar-inner,.site-header .col-aside-right-inner,.site-main .col-aside-left-inner,.site-main .col-sidebar-inner,.site-main .col-aside-right-inner{background:#f5f7f9 none repeat scroll 0% 0%;}.site-header .col-aside-left-and-sidebar-inner,.site-main .col-sidebar-inner{border-right:1px solid #e6ecf1;}.site-header .col-aside-right,.site-main .col-aside-right{border-left:1px solid #e6ecf1;}.brand{font-size:24px;font-weight:bold;height:100%;text-align:right;margin-right:20px;margin-top:10px;}
        </style>
    <link rel="stylesheet" type="text/css" href="../../../styles/master.min0e4d.css?v=todo">
    <!-- to fix/move? -->
    

    
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-55584370-32"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-131737769-1');
    </script>


</head>
<body>


<div class="site-header">
    <div class="col-aside-left-and-sidebar">
        <div class="col-aside-left-and-sidebar-inner">
            <div class="brand">
                <i class="fas fa-yin-yang" style="color: #0056b3;"></i>&nbsp;
                C Language Pedia
            </div>
        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
<div>
    <ul class="list-inline">
        <li class="list-inline-item"><a href="../../../index.html">Tutorial</a></li>
            <li class="list-inline-item"><a href="../../knowledge-base.html">Knowledge-Base</a></li>

            <li class="list-inline-item"><a href="../../awesome-learning/book.html">Awesome</a></li>
    </ul>
</div>

<style>
    .site-header .col-content .list-inline {
        padding-left: 20px;
        padding-top: 15px;

        font-weight: bold;
    }
</style>
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
            
        </div>
    </div>
</div>
<div class="site-main">
    <div class="col-aside-left">
        <div class="col-aside-left-inner">
            
        </div>
    </div>
    <div class="col-sidebar">
        <div class="col-sidebar-inner">

            <div class="col-sidebar-overflow">
                
            </div>

        </div>
    </div>
    <div class="col-content">
        <div class="col-content-inner">
            


<div id="knowledge-base" class="kb-details">
    <div class="row">
        <div class="col-lg-1 col-xl-1">
        </div>
        <div class="col-lg-9 col-xl-9" itemprop="mainEntity" itemscope itemtype="http://schema.org/Question">
            <div class="container-h1">
                <h1 itemprop="name" id="spi-initializing-in-atmel-studio">SPI initializing in Atmel studio</h1>
                <div class="tag-list">
                        <span class="tag-item"><a href="../tag/arduino.html">arduino</a></span>
                        <span class="tag-item"><a href="../tag/atmel.html">atmel</a></span>
                        <span class="tag-item"><a href="../tag/avr.html">avr</a></span>
                        <span class="tag-item"><a href="../tag/c.html">c</a></span>
                        <span class="tag-item"><a href="../tag/spi.html">spi</a></span>
                </div>
            </div>
            <br>
            <div class="search-results-container">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="block-question">
                            <div class="container-question">
                                <i class="fab fa-stack-overflow" style="font-size: 32px; position: absolute; left: -15px; top: -15px;"></i>
                                <h3 id="question">Question</h3>
                                <div itemprop="text">
                                    <p>im trying to use my Micro OLED Sparkfun display (here is the datasheet <a href="https://i.stack.imgur.com/xIahd.png" rel="nofollow noreferrer">enter link description here</a>) but i have a problem about code. Maybe is the problem in code because im working first time with SPI in Atmel so if would be somebody so nice and check it out, give me some advices about i will be so thankful.</p>

<p>EDIT: Here is the changed code and picture of display wires</p>

<pre><code>#define F_CPU 16000000
 #include &lt;avr/io.h&gt;
 #include &lt;util/delay.h&gt;
 #define SCK DDB5
 #define SDIN DDB3
 #define D_C DDB0
 #define CS DDB2
 #define RST DDB1

 void SPI_MasterInit(void)
 {
     /* Set MOSI and SCK output, all others input */
     DDRB = (1&lt;&lt;SCK)|(1&lt;&lt;SDIN)|(1&lt;&lt;D_C)|(1&lt;&lt;CS)|(1&lt;&lt;RST);
     /* Enable SPI, Master, set clock rate fck/16 */
     PORTB |= (1&lt;&lt;CS);
     PORTB |= (1&lt;&lt;D_C);
     SPCR = (1&lt;&lt;SPE)|(1&lt;&lt;MSTR)|(1&lt;&lt;SPR0)|(0&lt;&lt;DORD);
 }
 void SPI_MasterTransmit_Command(int cCommand)
 {
     PORTB &amp;= ~(1&lt;&lt;CS);
     PORTB &amp;= ~(1&lt;&lt;D_C);
     _delay_ms(200);
     /* Start transmission */
     SPDR = cCommand;
     /* set dc and cs low to send command */
     /* Wait for transmission complete */
     while(!(SPSR &amp; (1&lt;&lt;SPIF)));
     /* set dc cs high again */
     PORTB |= (1&lt;&lt;CS);
     PORTB |= (1&lt;&lt;D_C);


 }

 void Display_ON(void)
 {
     PORTB &amp;= ~(1&lt;&lt;RST);
     _delay_ms(50);
     PORTB |= (1&lt;&lt;RST);
     _delay_ms(50);
     PORTB &amp;= ~(1&lt;&lt;RST);
     _delay_ms(50);
     SPI_MasterTransmit_Command(0xAF);
     _delay_ms(200);
 }

 int main(void)
 {
     SPI_MasterInit();
     Display_ON();
     SPI_MasterTransmit_Command(0xA5);

 }
</code></pre>

<p><a href="https://i.stack.imgur.com/xIahd.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/xIahd.png" alt="enter image description here"></a></p>

                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="profile-container">
                                        <div class="profile-details-container d-flex align-items-center">
                                            <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="https://stackoverflow.com/users/0/user10400521" target="_blank"><span itemprop="name">user10400521</span></a></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: none">
                                    <div itemprop="answerCount">1</div>
                                    <div itemprop="upvoteCount">3</div>
                                    <div itemprop="dateCreated">9/24/2018 7:01:17 AM</div>
                                </div>
                            </div>
                        </div>
                        
                        <br/>
                    </div>
                    <div class="col-sm-6">
                            <div id="answer-0" class="block-question second-answer" itemprop="acceptedAnswer" itemscope itemtype="http://schema.org/Answer">
                                <div class="container-question">
                                    <h3 id="popular-answer">Popular Answer</h3>
                                    <div itemprop="text">
                                        <p><strong>First.</strong> When you're using SPI on AVR ATmega in the master mode, the SS pin, although it is not used directly by the SPI module, should be <em>always</em> configured as output, otherwise, high level on the pin will switch the SPI module into the slave mode. In other words, if you're using, for example, ATmega328(P), the PB2 should be configured as output (DD2 bit in DDRB should be set). It is a good idea to connect CS# of SSD1306 to this pin.</p>

<p><strong>Second</strong>.
When connecting SSD1306 there are 4 lines should be connected (see page 17 of the <a href="https://cdn.sparkfun.com/assets/learn_tutorials/3/0/8/SSD1306.pdf" rel="nofollow noreferrer">datasheet</a>):
1) SCLK - serial clock - connect it to the SCK pin of the SPI port (e.g. PB5 for ATmega328)
2) SDAT - serial data - connect it to the MOSI pin (PB3)
3) CS# - chip select - connect it to the SS pin (PB2)
4) D/#C - data/command select - connect it to any free pin (as I suppose you have connected it to PB0)
Also the modules may have RESET input, I think you have it connected to the PB1.</p>

<p>So, sending a data or command byte to the SSD1306 should look like this:</p>

<pre><code>PORTB &amp;= ~(1 &lt;&lt; CS); // pulling the CS# line low
PORTB |= (1 &lt;&lt; D_C); // high for DATA
or
PORTB &amp;= ~(1 &lt;&lt; D_C); // low for COMMAND
SPDR = cData; // transmit the byte
while(!(SPSR &amp; (1&lt;&lt;SPIF))) {} // wait the transmission to complete
PORTB |= (1 &lt;&lt; CS); // pull the CS# line back high
</code></pre>

<p>CS# can be held low through several commands, without rising up. It helps to determine edges of the command.</p>

<p><strong>Third</strong>.
Command 0xAF will turn the display on but probably it will show nothing because there is no data in it, so you may see no difference.
Try to send command 0xA5 just after that, it will light up all the pixels - just for the test purposes.</p>

<p><strong>UPD</strong>
Also, there you have to turn on the DC-DC charge pump (see the application note, page 62 at the end of the <a href="https://cdn.sparkfun.com/assets/learn_tutorials/3/0/8/SSD1306.pdf" rel="nofollow noreferrer">datasheet</a>). It is done by a sequence of two command bytes 0x8D 0x14. Send it before the turining the display on (i.e. before 0xAF)</p>

                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="profile-container">
                                            <div class="profile-details-container d-flex align-items-center">
                                                    <div class="asker-name" itemprop="author" itemscope itemtype="https://schema.org/Person">
                                                        <a href="https://stackoverflow.com/users/4931630/aterlux" target="_blank"><span itemprop="name">AterLux</span></a>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div style="display: none">
                                            <div itemprop="url">https://c.programmingpedia.net/en/knowledge-base/52456566/spi-initializing-in-atmel-studio#answer-0</div>
                                            <div itemprop="upvoteCount">1</div>
                                            <div itemprop="dateCreated">9/25/2018 7:38:16 AM</div>
                                        </div>
                                </div>
                            </div>
                            <br/>
                    </div>
                </div>
                <div class="text-center mt-5 mb-5">
                    <a href="https://stackoverflow.com/questions/52456566" class="btn-only d-inline-block stack-overflow-identity" target="_blank"><i class="fab fa-stack-overflow"></i> View more on Stack Overflow</a>
                </div>
            </div>
            
            <div class="attribution">
                <div>Licensed under: <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a> with <a href="https://stackoverflow.blog/2009/06/25/attribution-required/" target="_blank">attribution</a></div>
                <div>Not affiliated with: <a href="https://stackoverflow.com/questions/tagged/dapper" target="_blank">Stack Overflow</a></div>
                
            </div>
        </div>

    </div>
</div>
            
        </div>
    </div>
    <div class="col-aside-right">
        <div class="col-aside-right-inner">
        </div>
    </div>
</div>
<div class="site-footer">
</div>
    
    <a href="#" id="scroll-to-top" class="back-to-top" style="display: inline;">Icon</a>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="http://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script>
    $(function() {
        $('a').each(function() {
            var a = new RegExp('/' + window.location.host + '/');
            if (!a.test(this.href)) {
                $(this).attr("target", "_blank");
            }
        });

        $("table").addClass("table table-bordered table-hover table-responsive-sm table-striped");
        $("thead").addClass("thead-dark");

        $('aside a').each(function() {
            if ($(this).attr('href') == '/{{page.permalink}}' ||
                $(this).attr('href') == '{{ site.github.url }}/{{page.permalink}}') {
                $(this).addClass('font-weight-bold');
            }
        });
    });
</script>


</body>

<!-- Mirrored from c.programmingpedia.net/en/knowledge-base/52456566/spi-initializing-in-atmel-studio by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Jan 2021 10:14:57 GMT -->
</html>
